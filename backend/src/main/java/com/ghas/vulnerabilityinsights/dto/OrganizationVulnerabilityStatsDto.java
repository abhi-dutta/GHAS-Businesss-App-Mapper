package com.ghas.vulnerabilityinsights.dto;

import lombok.Data;

@Data
public class OrganizationVulnerabilityStatsDto {
    private VulnerabilityCategory sastVulnerabilities;
    private VulnerabilityCategory leakedSecrets;
    private VulnerabilityCategory scaVulnerabilities;
    private int totalVulnerabilities;
    private int repositoriesScanned;

    @Data
    public static class VulnerabilityCategory {
        private int total;
        private int critical;
        private int high;
        private int medium;
        private int low;

        public VulnerabilityCategory() {
            this.total = 0;
            this.critical = 0;
            this.high = 0;
            this.medium = 0;
            this.low = 0;
        }

        public void addVulnerability(String severity) {
            this.total++;
            if (severity != null) {
                switch (severity.toLowerCase()) {
                    case "critical":
                        this.critical++;
                        break;
                    case "high":
                        this.high++;
                        break;
                    case "medium":
                        this.medium++;
                        break;
                    case "low":
                        this.low++;
                        break;
                }
            }
        }
    }

    public OrganizationVulnerabilityStatsDto() {
        this.sastVulnerabilities = new VulnerabilityCategory();
        this.leakedSecrets = new VulnerabilityCategory();
        this.scaVulnerabilities = new VulnerabilityCategory();
        this.totalVulnerabilities = 0;
        this.repositoriesScanned = 0;
    }

    public void calculateTotalVulnerabilities() {
        this.totalVulnerabilities = this.sastVulnerabilities.getTotal() + 
                                   this.leakedSecrets.getTotal() + 
                                   this.scaVulnerabilities.getTotal();
    }
}
