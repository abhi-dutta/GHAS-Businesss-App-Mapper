package com.ghas.vulnerabilityinsights.repository;

import com.ghas.vulnerabilityinsights.model.BusinessApplication;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;
import java.util.Optional;

/**
 * Repository interface for BusinessApplication entity.
 */
@Repository
public interface BusinessApplicationRepository extends JpaRepository<BusinessApplication, Long> {
    
    /**
     * Find business applications by organization.
     */
    List<BusinessApplication> findByOrganization(String organization);
    
    /**
     * Find business application by name and organization.
     */
    Optional<BusinessApplication> findByNameAndOrganization(String name, String organization);
    
    /**
     * Find business applications by business owner email.
     */
    List<BusinessApplication> findByBusinessOwnerEmail(String businessOwnerEmail);
    
    /**
     * Count business applications by organization.
     */
    long countByOrganization(String organization);
    
    /**
     * Find business applications with their repository mappings.
     */
    @Query("SELECT ba FROM BusinessApplication ba LEFT JOIN FETCH ba.repositories WHERE ba.organization = :organization")
    List<BusinessApplication> findByOrganizationWithRepositories(@Param("organization") String organization);
}
