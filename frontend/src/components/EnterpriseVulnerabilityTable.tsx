import React from 'react';
import {
    Table,
    TableBody,
    TableCell,
    TableContainer,
    TableHead,
    TableRow,
    Typography,
    Box,
    Fade,
} from '@mui/material';
import {
    Security as SecurityIcon,
    Code as CodeIcon,
    Key as SecretIcon,
    Warning as AlertIcon,
    Business as OrganizationIcon,
} from '@mui/icons-material';
import { EnterpriseVulnerability } from '../types';

interface EnterpriseVulnerabilityTableProps {
    vulnerabilities: EnterpriseVulnerability[];
}

const EnterpriseVulnerabilityTable: React.FC<EnterpriseVulnerabilityTableProps> = ({ vulnerabilities }) => {
    const getSeverityBadge = (count: number, type: string) => {
        return (
            <Box sx={{
                display: 'inline-flex', 
                alignItems: 'center', 
                justifyContent: 'center',
                minWidth: 32, 
                padding: '4px 12px', 
                height: 32, 
                borderRadius: '16px',
                background: count === 0 ? 
                    'linear-gradient(135deg, #90EE90 0%, #7BCF7B 100%)' :
                    count <= 5 ?
                    'linear-gradient(135deg, #FFA500 0%, #FF8C00 100%)' :
                    'linear-gradient(135deg, #8B0000 0%, #B22222 100%)',
                color: 'white',
                fontWeight: 'bold', 
                fontSize: '0.85rem',
                boxShadow: count === 0 ? 
                    '0 2px 8px rgba(144, 238, 144, 0.3)' :
                    count <= 5 ?
                    '0 2px 8px rgba(255, 165, 0, 0.3)' :
                    '0 2px 8px rgba(139, 0, 0, 0.4)',
                '&:hover': {
                    transform: 'scale(1.05)',
                    transition: 'all 0.2s ease',
                }
            }}>
                {count}
            </Box>
        );
    };

    if (!vulnerabilities || vulnerabilities.length === 0) {
        return (
            <Box sx={{ 
                textAlign: 'center', 
                py: 8,
                background: 'linear-gradient(135deg, rgba(103, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%)',
                borderRadius: 2,
            }}>
                <SecurityIcon sx={{ fontSize: 64, color: 'text.disabled', mb: 2 }} />
                <Typography variant="h6" color="text.secondary" sx={{ fontWeight: 500 }}>
                    No enterprise vulnerability data available
                </Typography>
                <Typography variant="body2" color="text.disabled" sx={{ mt: 1 }}>
                    Configure your enterprise settings to view vulnerability insights
                </Typography>
            </Box>
        );
    }

    return (
        <TableContainer 
            sx={{ 
                borderRadius: 2,
                overflow: 'hidden',
                boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
            }}
        >
            <Table>
                <TableHead>
                    <TableRow sx={{
                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    }}>
                        <TableCell sx={{ fontWeight: 'bold', color: 'white' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <OrganizationIcon sx={{ mr: 1, fontSize: 20 }} />
                                Organization
                            </Box>
                        </TableCell>
                        <TableCell sx={{ fontWeight: 'bold', color: 'white' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <SecurityIcon sx={{ mr: 1, fontSize: 20 }} />
                                Dependabot Alerts
                            </Box>
                        </TableCell>
                        <TableCell sx={{ fontWeight: 'bold', color: 'white' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <CodeIcon sx={{ mr: 1, fontSize: 20 }} />
                                Code Scanning Alerts
                            </Box>
                        </TableCell>
                        <TableCell sx={{ fontWeight: 'bold', color: 'white' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <SecretIcon sx={{ mr: 1, fontSize: 20 }} />
                                Secret Scanning Alerts
                            </Box>
                        </TableCell>
                        <TableCell sx={{ fontWeight: 'bold', color: 'white' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <AlertIcon sx={{ mr: 1, fontSize: 20 }} />
                                Total Alerts
                            </Box>
                        </TableCell>
                    </TableRow>
                </TableHead>
                <TableBody>
                    {vulnerabilities.map((vuln, index) => (
                        <Fade in timeout={300} style={{ transitionDelay: `${index * 100}ms` }} key={vuln.organization}>
                            <TableRow 
                                sx={{
                                    '&:nth-of-type(odd)': {
                                        backgroundColor: 'rgba(102, 126, 234, 0.02)',
                                    },
                                    '&:hover': {
                                        backgroundColor: 'rgba(102, 126, 234, 0.08)',
                                        transform: 'scale(1.01)',
                                        transition: 'all 0.2s ease',
                                    },
                                    transition: 'all 0.2s ease',
                                }}
                            >
                                <TableCell>
                                    <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                        <OrganizationIcon sx={{ mr: 1, color: '#667eea' }} />
                                        <Typography variant="body1" sx={{ fontWeight: 500 }}>
                                            {vuln.organization}
                                        </Typography>
                                    </Box>
                                </TableCell>
                                <TableCell>
                                    {getSeverityBadge(vuln.dependabotAlerts, 'dependabot')}
                                </TableCell>
                                <TableCell>
                                    {getSeverityBadge(vuln.codeScanningAlerts, 'codeScanning')}
                                </TableCell>
                                <TableCell>
                                    {getSeverityBadge(vuln.secretScanningAlerts, 'secretScanning')}
                                </TableCell>
                                <TableCell>
                                    <Box sx={{
                                        display: 'inline-flex', 
                                        alignItems: 'center', 
                                        justifyContent: 'center',
                                        minWidth: 32, 
                                        padding: '4px 12px', 
                                        height: 32, 
                                        borderRadius: '16px',
                                        background: vuln.totalAlerts === 0 ? 
                                            'linear-gradient(135deg, #90EE90 0%, #7BCF7B 100%)' :
                                            vuln.totalAlerts <= 10 ?
                                            'linear-gradient(135deg, #FFA500 0%, #FF8C00 100%)' :
                                            'linear-gradient(135deg, #8B0000 0%, #B22222 100%)',
                                        color: 'white',
                                        fontWeight: 'bold', 
                                        fontSize: '0.85rem',
                                        boxShadow: vuln.totalAlerts === 0 ? 
                                            '0 2px 8px rgba(144, 238, 144, 0.3)' :
                                            vuln.totalAlerts <= 10 ?
                                            '0 2px 8px rgba(255, 165, 0, 0.3)' :
                                            '0 2px 8px rgba(139, 0, 0, 0.4)',
                                        '&:hover': {
                                            transform: 'scale(1.05)',
                                            transition: 'all 0.2s ease',
                                        }
                                    }}>
                                        {vuln.totalAlerts}
                                    </Box>
                                </TableCell>
                            </TableRow>
                        </Fade>
                    ))}
                </TableBody>
            </Table>
        </TableContainer>
    );
};

export default EnterpriseVulnerabilityTable;
