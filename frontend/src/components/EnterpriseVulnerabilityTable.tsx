import React from 'react';
import {
    Table,
    TableBody,
    TableCell,
    TableContainer,
    TableHead,
    TableRow,
    Typography,
    Chip,
    Box,
    Fade,
} from '@mui/material';
import {
    Security as SecurityIcon,
    Code as CodeIcon,
    Key as SecretIcon,
    Warning as AlertIcon,
    Business as OrganizationIcon,
} from '@mui/icons-material';
import { EnterpriseVulnerability } from '../types';

interface EnterpriseVulnerabilityTableProps {
    vulnerabilities: EnterpriseVulnerability[];
}

const EnterpriseVulnerabilityTable: React.FC<EnterpriseVulnerabilityTableProps> = ({ vulnerabilities }) => {
    const getSeverityColor = (count: number) => {
        if (count === 0) return 'success';
        if (count <= 5) return 'warning';
        return 'error';
    };

    const getSeverityChip = (count: number, type: string) => {
        const color = getSeverityColor(count);
        return (
            <Chip
                label={count}
                color={color}
                size="small"
                sx={{
                    fontWeight: 700,
                    minWidth: 50,
                    '&:hover': {
                        transform: 'scale(1.05)',
                    }
                }}
            />
        );
    };

    if (!vulnerabilities || vulnerabilities.length === 0) {
        return (
            <Box sx={{ 
                textAlign: 'center', 
                py: 8,
                background: 'linear-gradient(135deg, rgba(103, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%)',
                borderRadius: 2,
            }}>
                <SecurityIcon sx={{ fontSize: 64, color: 'text.disabled', mb: 2 }} />
                <Typography variant="h6" color="text.secondary" sx={{ fontWeight: 500 }}>
                    No enterprise vulnerability data available
                </Typography>
                <Typography variant="body2" color="text.disabled" sx={{ mt: 1 }}>
                    Configure your enterprise settings to view vulnerability insights
                </Typography>
            </Box>
        );
    }

    return (
        <TableContainer sx={{ borderRadius: 2 }}>
            <Table>
                <TableHead>
                    <TableRow sx={{
                        background: 'linear-gradient(135deg, rgba(103, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%)',
                    }}>
                        <TableCell sx={{ fontWeight: 700, color: 'primary.main' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <OrganizationIcon sx={{ mr: 1, fontSize: 20 }} />
                                Organization
                            </Box>
                        </TableCell>
                        <TableCell sx={{ fontWeight: 700, color: 'primary.main' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <SecurityIcon sx={{ mr: 1, fontSize: 20 }} />
                                Dependabot Alerts
                            </Box>
                        </TableCell>
                        <TableCell sx={{ fontWeight: 700, color: 'primary.main' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <CodeIcon sx={{ mr: 1, fontSize: 20 }} />
                                Code Scanning Alerts
                            </Box>
                        </TableCell>
                        <TableCell sx={{ fontWeight: 700, color: 'primary.main' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <SecretIcon sx={{ mr: 1, fontSize: 20 }} />
                                Secret Scanning Alerts
                            </Box>
                        </TableCell>
                        <TableCell sx={{ fontWeight: 700, color: 'primary.main' }}>
                            <Box sx={{ display: 'flex', alignItems: 'center' }}>
                                <AlertIcon sx={{ mr: 1, fontSize: 20 }} />
                                Total Alerts
                            </Box>
                        </TableCell>
                    </TableRow>
                </TableHead>
                <TableBody>
                    {vulnerabilities.map((vuln, index) => (
                        <Fade in timeout={300} style={{ transitionDelay: `${index * 100}ms` }} key={vuln.organization}>
                            <TableRow 
                                sx={{
                                    transition: 'all 0.3s ease',
                                    '&:hover': {
                                        background: 'linear-gradient(135deg, rgba(103, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%)',
                                        transform: 'translateX(4px)',
                                    }
                                }}
                            >
                                <TableCell>
                                    <Typography variant="body1" sx={{ fontWeight: 600, color: 'primary.main' }}>
                                        {vuln.organization}
                                    </Typography>
                                </TableCell>
                                <TableCell>
                                    {getSeverityChip(vuln.dependabotAlerts, 'dependabot')}
                                </TableCell>
                                <TableCell>
                                    {getSeverityChip(vuln.codeScanningAlerts, 'codeScanning')}
                                </TableCell>
                                <TableCell>
                                    {getSeverityChip(vuln.secretScanningAlerts, 'secretScanning')}
                                </TableCell>
                                <TableCell>
                                    <Chip
                                        label={vuln.totalAlerts}
                                        color={getSeverityColor(vuln.totalAlerts)}
                                        size="medium"
                                        sx={{
                                            fontWeight: 700,
                                            fontSize: '0.875rem',
                                            minWidth: 60,
                                            background: vuln.totalAlerts > 10 
                                                ? 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)'
                                                : vuln.totalAlerts > 5
                                                ? 'linear-gradient(135deg, #ff9800 0%, #f57c00 100%)'
                                                : 'linear-gradient(135deg, #4caf50 0%, #388e3c 100%)',
                                            color: 'white',
                                            '&:hover': {
                                                transform: 'scale(1.1)',
                                                boxShadow: '0 4px 20px rgba(0,0,0,0.2)',
                                            }
                                        }}
                                    />
                                </TableCell>
                            </TableRow>
                        </Fade>
                    ))}
                </TableBody>
            </Table>
        </TableContainer>
    );
};

export default EnterpriseVulnerabilityTable;
